"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1571],{3905:function(n,e,t){t.d(e,{Zo:function(){return l},kt:function(){return p}});var a=t(7294);function r(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function o(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,a)}return t}function i(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?o(Object(t),!0).forEach((function(e){r(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function u(n,e){if(null==n)return{};var t,a,r=function(n,e){if(null==n)return{};var t,a,r={},o=Object.keys(n);for(a=0;a<o.length;a++)t=o[a],e.indexOf(t)>=0||(r[t]=n[t]);return r}(n,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(a=0;a<o.length;a++)t=o[a],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(r[t]=n[t])}return r}var s=a.createContext({}),c=function(n){var e=a.useContext(s),t=e;return n&&(t="function"==typeof n?n(e):i(i({},e),n)),t},l=function(n){var e=c(n.components);return a.createElement(s.Provider,{value:e},n.children)},$={inlineCode:"code",wrapper:function(n){var e=n.children;return a.createElement(a.Fragment,{},e)}},m=a.forwardRef((function(n,e){var t=n.components,r=n.mdxType,o=n.originalType,s=n.parentName,l=u(n,["components","mdxType","originalType","parentName"]),m=c(t),p=r,f=m["".concat(s,".").concat(p)]||m[p]||$[p]||o;return t?a.createElement(f,i(i({ref:e},l),{},{components:t})):a.createElement(f,i({ref:e},l))}));function p(n,e){var t=arguments,r=e&&e.mdxType;if("string"==typeof n||r){var o=t.length,i=new Array(o);i[0]=m;var u={};for(var s in e)hasOwnProperty.call(e,s)&&(u[s]=e[s]);u.originalType=n,u.mdxType="string"==typeof n?n:r,i[1]=u;for(var c=2;c<o;c++)i[c]=t[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},8584:function(n,e,t){t.r(e),t.d(e,{assets:function(){return l},contentTitle:function(){return s},default:function(){return p},frontMatter:function(){return u},metadata:function(){return c},toc:function(){return $}});var a=t(7462),r=t(3366),o=(t(7294),t(3905)),i=["components"],u={title:"\u821e\u53f0\u9009\u5ea7\u4f4d",date:"2022-02-26 16:00:00 +0800",tags:["php-algorithm"]},s=void 0,c={unversionedId:"Algorithm/choice-seat",id:"Algorithm/choice-seat",title:"\u821e\u53f0\u9009\u5ea7\u4f4d",description:"\u821e\u53f0\u9009\u5ea7\u4f4d-Gist",source:"@site/docs/Algorithm/10-choice-seat.md",sourceDirName:"Algorithm",slug:"/Algorithm/choice-seat",permalink:"/docs/Algorithm/choice-seat",draft:!1,tags:[{label:"php-algorithm",permalink:"/docs/tags/php-algorithm"}],version:"current",sidebarPosition:10,frontMatter:{title:"\u821e\u53f0\u9009\u5ea7\u4f4d",date:"2022-02-26 16:00:00 +0800",tags:["php-algorithm"]},sidebar:"tutorialSidebar",previous:{title:"99\u4e58\u6cd5\u8868",permalink:"/docs/Algorithm/times-table"},next:{title:"\u68c0\u67e5\u670d\u52a1\u8fd0\u884c\u72b6\u6001",permalink:"/docs/DevOps/check-service-status"}},l={},$=[{value:"\u95ee\u9898\u63cf\u8ff0",id:"\u95ee\u9898\u63cf\u8ff0",level:3}],m={toc:$};function p(n){var e=n.components,t=(0,r.Z)(n,i);return(0,o.kt)("wrapper",(0,a.Z)({},m,t,{components:e,mdxType:"MDXLayout"}),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("a",{parentName:"p",href:"https://gist.github.com/helloxxb/72f4fff8cdf0ade61314207d30dfaf41"},"\u821e\u53f0\u9009\u5ea7\u4f4d-Gist"))),(0,o.kt)("h3",{id:"\u95ee\u9898\u63cf\u8ff0"},"\u95ee\u9898\u63cf\u8ff0"),(0,o.kt)("p",null,"\u67d0\u516c\u53f8\u8981\u5728\u4f53\u80b2\u9986\u529e\u4e00\u573a\u665a\u4f1a\uff0c\u4f53\u80b2\u9986\u7531ABCD\u56db\u4e2a\u533a\u57df\u7ec4\u6210\uff0c\u533a\u57df\u4e4b\u95f4\u7531\u8fc7\u9053\u5206\u5272\uff0c\u6bcf\u4e2a\u533a\u57df\u7b2c\u4e00\u639250\u4e2a\u5ea7\u4f4d\uff0c\u9694\u6392\u9012\u589e2\u4e2a\u5ea7\u4f4d\uff0c\u6700\u540e\u4e00\u6392\u4e3a100\u4e2a\u5ea7\u4f4d\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-php"},"/**\n * \u573a\u666f\uff1a\n * \u67d0\u516c\u53f8\u8981\u5728\u4f53\u80b2\u9986\u529e\u4e00\u573a\u665a\u4f1a\uff0c\u4f53\u80b2\u9986\u7531ABCD\u56db\u4e2a\u533a\u57df\u7ec4\u6210\uff0c\n * \u533a\u57df\u4e4b\u95f4\u7531\u8fc7\u9053\u5206\u5272\uff0c\u6bcf\u4e2a\u533a\u57df\u7b2c\u4e00\u639250\u4e2a\u5ea7\u4f4d\uff0c\u9694\u6392\u9012\u589e2\u4e2a\u5ea7\u4f4d\uff0c\n * \u6700\u540e\u4e00\u6392\u4e3a100\u4e2a\u5ea7\u4f4d\u3002\n *\n * \u8bf7\u60a8\u5e2e\u5fd9\u8bbe\u8ba1\u4e00\u4e2a\u7cfb\u7edf\uff0c\u89e3\u51b3\u4ee5\u4e0b\u9700\u6c42\u70b9\uff1a\n * 1. \u7528\u6237\u4e00\u6b21\u6027\u53ef\u8d2d\u4e701~5\u5f20\u7968\n * 2. \u7cfb\u7edf\u968f\u673a\u4e3a\u7528\u6237\u5206\u914d\u5ea7\u4f4d\n */\n\n/**\n * \u821e\u53f0\u9009\u5ea7\u4f4d\n */\nclass ChoiceSeat\n{\n    /**\n     * @var int \u7b2c\u4e00\u6392\u591a\u5c11\u4e2a\u5ea7\u4f4d\uff0c\u9ed8\u8ba4\uff1a50\n     */\n    private $baseSeatNumber = 50;\n    /**\n     * @var int \u6700\u540e\u4e00\u6392\u591a\u5c11\u4e2a\u5ea7\u4f4d\uff0c\u9ed8\u8ba4\uff1a100\n     */\n    private $lastSeatNumber = 100;\n    /**\n     * @var array \u603b\u9012\u589e\u5ea7\u4f4d\u7f16\u53f7\u96c6\u5408\n     */\n    private $totalSeats = [];\n\n    /**\n     * @var string \u603b\u5ea7\u4f4d\u7f16\u53f7\u7f13\u5b58\u6587\u4ef6\n     */\n    private static $cacheFilename = 'total-seats.bin';\n\n    /**\n     * ChoiceSeat constructor.\n     */\n    public function __construct()\n    {\n        $cache = $this->getTotalSeatsByCache();\n        if (empty($cache)) {\n            /**\n             * \u6c42\u51fa\u603b\u5171\u9700\u8981\u591a\u5c11\u6392\n             * x=\u9700\u8981\u591a\u5c11\u6392\uff0c\u4ece0\u5f00\u59cb\uff0c\u9694\u6392+2\u4e2a\u5ea7\u4f4d\u3002\n             * \u8bbe\u65b9\u7a0b\u5f0f\uff1a50 + (x * 2) = 100 (\u4e00\u5143\u4e00\u6b21\u65b9\u7a0b)\n             * \u89e3\uff1a\n             *   2x = 100 - 50\n             *    x = 50/2\n             */\n            $baseSeatNumber = $this->getBaseSeatNumber();\n            $lastSeatNumber = $this->getLastSeatNumber();\n            if (empty($baseSeatNumber) || empty($lastSeatNumber)) {\n                throw new Exception('\u7b2c\u4e00\u6392\u548c\u6700\u540e\u4e00\u6392\u5ea7\u4f4d\u6570\u4e0d\u80fd\u4e3a\u7a7a');\n            }\n            // \u8fd8\u9700\u8981 $x \u6392\uff0c\u603b\u6392\u6570 $x + 1\uff08\u7b2c\u4e00\u6392\uff09\n            $x = ($lastSeatNumber - $baseSeatNumber) / 2;\n\n            $areas = ['A', 'B', 'C', 'D'];\n            foreach ($areas as $areaCode) {\n                // \u533a\u57df\u7684\u603b\u9012\u589e\u5ea7\u4f4d\u7f16\u53f7\n                $totalCounter = 1;\n                for ($row = 0; $row < $x + 1; $row++) {\n                    // \u6bcf\u6392\u7684\u5ea7\u4f4d\u7f16\u53f7\u8303\u56f4\uff08\u9694\u6392+2\uff09\n                    $endSeatNumber = $baseSeatNumber + ($row * 2);\n                    for ($j = 1; $j <= $endSeatNumber; $j++) {\n                        // \u603b\u4f53\u5ea7\u4f4d\u7f16\u53f7\uff1a\u533a\u57df\u7f16\u53f7-\u6392\u7684\u7f16\u53f7-\u533a\u57df\u7684\u603b\u9012\u589e\u5ea7\u4f4d\u6570\n                        $uuid = sprintf(\"%s%'.04d%'.06d\", $areaCode, ($row + 1), $totalCounter);\n                        // \u5546\u54c1\u540d\u79f0\n                        $name = sprintf(\"%s\u533a%s\u6392%s\u53f7\", $areaCode, ($row + 1), $j);\n\n                        $this->addSeat([\n                            'uuid' => $uuid,\n                            'name' => $name,\n                        ]);\n\n                        $totalCounter ++;\n                    }\n                }\n            }\n            // \u7f13\u5b58\u5230\u6587\u4ef6\n            $totalSeats = $this->getTotalSeats();\n            if (!empty($totalSeats)) {\n                $cacheValue = serialize($totalSeats);\n            } else {\n                $cacheValue = serialize([]);\n            }\n            $handle = fopen(self::$cacheFilename, 'w');\n            flock($handle, LOCK_EX);\n            fwrite($handle, $cacheValue);\n            flock($handle, LOCK_UN);\n            fclose($handle);\n        } else {\n            $this->setTotalSeats($cache);\n        }\n    }\n\n    /**\n     * @return int\n     */\n    public function getBaseSeatNumber()\n    {\n        return $this->baseSeatNumber;\n    }\n\n    /**\n     * @param int $baseSeatNumber\n     *\n     * @return $this\n     */\n    public function setBaseSeatNumber($baseSeatNumber)\n    {\n        $this->baseSeatNumber = $baseSeatNumber;\n        return $this;\n    }\n\n    /**\n     * @return int\n     */\n    public function getLastSeatNumber()\n    {\n        return $this->lastSeatNumber;\n    }\n\n    /**\n     * @param int $lastSeatNumber\n     *\n     * @return $this\n     */\n    public function setLastSeatNumber($lastSeatNumber)\n    {\n        $this->lastSeatNumber = $lastSeatNumber;\n        return $this;\n    }\n\n    /**\n     * @return array\n     */\n    public function getTotalSeats()\n    {\n        return $this->totalSeats;\n    }\n\n    /**\n     * @param array $totalSeats\n     */\n    public function setTotalSeats($totalSeats)\n    {\n        $this->totalSeats = $totalSeats;\n    }\n\n    /**\n     * @param array $uuid\n     */\n    public function addSeat($uuid)\n    {\n        $this->totalSeats[] = $uuid;\n    }\n\n    /**\n     * \u83b7\u53d6\u8fde\u7eed\u7684\u5ea7\u4f4d\n     *\n     * @param int $needNumber \u9700\u8981\u591a\u5c11\u4e2a\u5ea7\u4f4d\n     *\n     * @return array\n     */\n    public function getSerialSeat($needNumber = 0)\n    {\n        // TODO \u672a\u5b9e\u73b0\n        return [];\n    }\n\n    /**\n     * \u83b7\u53d6\u7cfb\u7edf\u968f\u673a\u5206\u914d\u7684\u5ea7\u4f4d\n     *\n     * @param int $needNumber \u9700\u8981\u591a\u5c11\u4e2a\u5ea7\u4f4d\n     *\n     * @return array\n     */\n    public function getRandomSeat($needNumber = 0)\n    {\n        $totalSeats = $this->getTotalSeats();\n        if (empty($totalSeats)) {\n            return [];\n        }\n\n        // \u968f\u673a\u53d6\u51fa\u51e0\u4e2a\u5143\u7d20\u7684\u952e\n        $return     = [];\n        $randomKeys = array_rand($totalSeats, $needNumber);\n        if (!empty($randomKeys)) {\n            foreach ($randomKeys as $key) {\n                if (isset($totalSeats[$key])) {\n                    $return[] = $totalSeats[$key];\n                }\n            }\n        }\n\n        return $return;\n    }\n\n    /**\n     * \u83b7\u53d6\u603b\u5ea7\u4f4d\u7f16\u53f7\u7f13\u5b58\n     *\n     * @return array\n     */\n    private function getTotalSeatsByCache()\n    {\n        $cachaData = [];\n\n        $handle = @fopen(self::$cacheFilename, 'r');\n        if ($handle !== false) {\n            flock($handle, LOCK_EX);\n            $content = '';\n            while (!feof($handle)) {\n                $buffer = fgets($handle, 4096);\n                $content .= $buffer;\n            }\n            flock($handle, LOCK_UN);\n            fclose($handle);\n\n            if (!empty($content)) {\n                $array = unserialize($content);\n                if ($array !== false) {\n                    $cachaData = $array;\n                }\n            }\n        }\n\n        return $cachaData;\n    }\n}\n\n$service = new ChoiceSeat();\n//// \u968f\u673a\u9009\u62e95\u4e2a\u5ea7\u4f4d\n//$output = $service->getRandomSeat(5);\n//foreach ($output as $item) {\n//    echo sprintf('\u7f16\u53f7\uff1a%s \u5546\u54c1\uff1a%s', $item['uuid'], $item['name']) . PHP_EOL;\n//}\n//die;\n\n\n// !!! \u63a2\u7d22\u589e\u52a0\u7b5b\u9009\u6761\u4ef6\uff1a\u6bd4\u5982\uff1a\u540c\u4e00\u533a\u57df\u3001\u540c\u4e00\u6392\u3001\u5ea7\u4f4d\u53f7\u662f\u5426\u9700\u8981\u8fde\u7eed\n\n\n//// \u603b\u7f16\u53f7\u96c6\u5408\n//$output = $service->getTotalSeats();\n//foreach ($output as $item) {\n//    echo sprintf('\u7f16\u53f7\uff1a%s \u5546\u54c1\uff1a%s', $item['uuid'], $item['name']) . PHP_EOL;\n//}\n//die;\n")))}p.isMDXComponent=!0}}]);